// Setup Game
info.player1.setScore(0)
info.player1.setLife(3)
// Create Character
let running_man_right = img`
    . . . . . . . . . . . . . . . .
    . . . f f f f f f . . . . . . .
    . . f 1 1 1 1 1 1 f . . . . . .
    . b f 1 1 f 1 f 1 f b . . . . .
    b . f 1 1 f 1 f 1 f . b . . . .
    b . f 1 1 1 1 1 1 f . b . . . .
    . b b f f f f f f . . b . . . .
    b b b f 2 2 2 2 f . f b f f f .
    b b b f 2 2 2 2 f f c c c c c f
    c c c f 2 2 2 2 f f c f f f f .
    . c c f 2 2 2 2 f f c f . . . .
    . . c f f f f f f . f . . . . .
    . . . f . . . . f . . . . . . .
    . . . f . . . . f . . . . . . .
    . . . f . . . . f . . . . . . .
    . . . f . . . . f . . . . . . .
`
let running_man_left = img`
    . . . . . . . . . . . . . . . .
    . . . f f f f f f . . . . . . .
    . . f 1 1 1 1 1 1 f . . . . . .
    . b f 1 1 f 1 f 1 f b . . . . .
    b . f 1 1 f 1 f 1 f . b . . . .
    b . f 1 1 1 1 1 1 f . b . . . .
    . b b f f f f f f . . b . . . .
    b b b f 8 8 8 8 f . f b f f f .
    b b b f 8 8 8 8 f f c c c c c f
    c c c f 8 8 8 8 f f c f f f f .
    . c c f 8 8 8 8 f f c f . . . .
    . . c f f f f f f . f . . . . .
    . . . f . . . . f . . . . . . .
    . . . f . . . . f . . . . . . .
    . . . f . . . . f . . . . . . .
    . . . f . . . . f . . . . . . .
`
let running_man = sprites.create(running_man_right, SpriteKind.Player)
running_man.ay = 200
scene.cameraFollowSprite(running_man)
animation.runImageAnimation(running_man, [])
controller.player1.onButtonEvent(ControllerButton.Right, ControllerButtonEvent.Pressed, function face_right() {
    running_man.setImage(running_man_right)
})
controller.player1.onButtonEvent(ControllerButton.Left, ControllerButtonEvent.Pressed, function face_left() {
    running_man.setImage(running_man_left)
})
// create tileset
tiles.setTilemap(tilemap`level`)
scene.setBackgroundColor(6)
// create gravity and jump
let canDoublejump = true
controller.moveSprite(running_man, 50, 0)
controller.player1.onButtonEvent(ControllerButton.A, ControllerButtonEvent.Pressed, function on_jump() {
    
    if (running_man.isHittingTile(CollisionDirection.Bottom) || canDoublejump) {
        running_man.vy = -100
        canDoublejump = running_man.isHittingTile(CollisionDirection.Bottom)
    }
    
})
// Create enemies
let puff = sprites.create(img`
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . 4 4 4 4 4 . . . . . .
    . . . . 4 4 4 4 4 4 4 . . . . .
    . . . . 4 1 4 4 4 1 4 . . . . .
    . . . . 4 f 1 4 f 1 4 . . . . .
    . . . . 4 f 1 4 f 1 4 . . . . .
    . . . . 4 4 4 4 4 4 4 . . . . .
    . . . . 2 4 4 4 4 4 2 2 . . . .
    . . . 2 2 2 . . . 2 2 2 . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
    . . . . . . . . . . . . . . . .
`, SpriteKind.Enemy)
puff.ay = 200
tiles.placeOnTile(puff, tiles.getTileLocation(10, 13))
tiles.placeOnTile(puff, tiles.getTileLocation(17, 12))
tiles.placeOnTile(puff, tiles.getTileLocation(33, 11))
let boss_puff = sprites.create(img`
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ..........................4444444444444.........................
    ........................44444444444444444.......................
    ......................444444444444444444444.....................
    ....................4444444444444444444444444...................
    ...................444444444444444444444444444..................
    ..................44444444444444444444444444444.................
    .................4444444444444444444444444444444................
    ................444444444444444444444444444444444...............
    ...............44444444444444444444444444444444444..............
    ...............44444444444444444444444444444444444..............
    ..............4444444444444444444444444444444444444.............
    ..............4444444444444444444444444444444444444.............
    .............444444144444444444444444441444444444444............
    .............444444114444444444444444411444444444444............
    ............44444441114444444444444441114444444444444...........
    ............4444444ff11444444444444411114444444444444...........
    ............4444444fff1144444444444f11114444444444444...........
    ............4444444fff111444444444ff11114444444444444...........
    ............4444444fff11114444444fff11114444444444444...........
    ............4444444fff11114444444fff11114444444444444...........
    ............4444444fff11114444444fff11114444444444444...........
    ............4444444fff11114444444fff11114444444444444...........
    ............4444444fff11114444444fff11114444444444444...........
    ............4444444ff111114444444ff111114444444444444...........
    ............44444441111111444444411111114444444444444...........
    ............44444444111114444444441111144444444444444...........
    ............44444444444444444444444444444444444444444...........
    .............4444444444444444444444444444444444444444...........
    .............444444444444444444444444444444444444444............
    ..............4444444444444444444444444444444444444.............
    ..............44444444444fffffffffff444444444444444.............
    ...............44444444444444444444444444444444444..............
    ...............44444444444444444444444444444444444..............
    ................444444444444444444444444444444444...............
    ................24444444444444444444444444444444................
    ................224444444444444444444444444222222...............
    ..............222224444444444444444444444222222222..............
    .............2222222444444444444444444442222222222..............
    ............222222222244444444444444444222222222222.............
    ...........2222222222222444444444444442222222222222.............
    ..........22222222222222224444444444422222222222222.............
    ..........2222222222222222..........222222222222222.............
    ..........2222222222222222.........2222222222222222.............
    .........22222222222222222.........2222222222222222.............
    .........2222222222222222.........22222222222222222.............
    .........2222222222222222.........22222222222222222.............
    .........2222222222222222.........2222222222222222..............
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
    ................................................................
`)
boss_puff.ay = 200
sprites.onOverlap(SpriteKind.Player, SpriteKind.Enemy, function on_overlap2(sprite: Sprite, otherSprite: Sprite) {
    puff.destroy()
    info.changeLifeBy(-1)
})
// Create projectiles
controller.B.onEvent(ControllerButtonEvent.Pressed, function on_event_pressed() {
    let bb = sprites.createProjectileFromSprite(img`
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . b b b . . . . . .
        . . . . . . b b b b b . . . . .
        . . . . . . b b b b b . . . . .
        . . . . . . b b b b b . . . . .
        . . . . . . . b b b . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . .
    `, running_man, 50, 0)
})
//  def on_button_event_b_pressed():
//      bb = sprites.create(img("""
//          . . . . . . . . . . . . . . . .
//          . . . . . . . . . . . . . . . .
//          . . . . . . . . . . . . . . . .
//          . . . . . . . . . . . . . . . .
//          . . . . . . . . . . . . . . . .
//          . . . . . . . b b b . . . . . .
//          . . . . . . b b b b b . . . . .
//          . . . . . . b b b b b . . . . .
//          . . . . . . b b b b b . . . . .
//          . . . . . . . b b b . . . . . .
//          . . . . . . . . . . . . . . . .
//          . . . . . . . . . . . . . . . .
//          . . . . . . . . . . . . . . . .
//          . . . . . . . . . . . . . . . .
//          . . . . . . . . . . . . . . . .
//          . . . . . . . . . . . . . . . .
//      """),SpriteKind.projectile)
//  controller.B.on_event(ControllerButtonEvent.PRESSED, on_button_event_b_pressed)
// Create goal
let goal = sprites.create(img`
    . . . 2 4 1 . .
    . . 2 4 4 1 . .
    . 2 4 4 4 1 . .
    2 4 4 4 4 1 . .
    . 4 4 4 4 1 . .
    . . 4 4 4 1 . .
    . . . 4 4 1 . .
    . . . . b 1 . .
    . . . . b 1 . .
    . . . . b 1 . .
    . . . . b 1 . .
    . . . . b 1 . .
    . . . . b 1 . .
    . . . . b 1 . .
    . . . . b 1 . .
    . . . . b 1 . .
    . . . . b 1 . .
    . . . . b 1 . .
    . . . 4 5 5 5 .
    . . 4 5 5 5 5 5
`, SpriteKind.Player)
tiles.placeOnTile(goal, tiles.getTileLocation(48, 12))
sprites.onOverlap(SpriteKind.Player, SpriteKind.Player, function on_overlap(sprite: Sprite, otherSprite: Sprite) {
    game.over()
})
// Create music
music.playMelody("E E E Eb E E C C", 300)
music.playMelody("B B B B", 150)
music.playMelody("Ab A Ab A Ab A Ab A", 300)
music.playMelody("E E E Eb E E C C", 300)
music.playMelody("B B B B", 150)
music.playMelody("Ab A Ab A - Bb A", 300)
